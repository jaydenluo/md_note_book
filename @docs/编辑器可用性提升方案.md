以下是编辑器功能增强列表，按实现难度从易到难排序：


##  **基础格式工具栏**
   - 加粗、斜体、下划线、删除线等基本文本格式
   - 标题级别（H1-H6）
   - 对齐方式（左、中、右对齐）
   - 列表（有序、无序）

##  **大纲功能**
   - 显示笔记大纲
   - 点击大快速定位
   - 大纲折叠
   

##  **标题小H提示与折叠功能**
  - 显示标题是H1~H6的小H提示
  - 折叠标题,并能持久化保存，通过给标题增加一个属性data-folded="true"折叠功能,级下级节点增加 hidden-by-fold="true"，实隐藏。

## **代码块支持**
   
   ### 功能需求分析
   - 当前项目使用TipTap编辑器框架
   - 已有基本的代码块功能，但需要增强用户体验
   - 需要支持多种编程语言的语法高亮
   - 需要添加行号显示功能
   - 需要添加代码复制按钮 右上角小图标
   - 需要支持Markdown语法快速创建代码块
   - 需要支持代码块内容折叠功能
   - 需要支持代码块可拖动调整大小
   - 需要支持代码块内容区域可滚动

   ### 子任务列表
   
   #### 4.1 基础代码块功能实现
   - 实现基础代码块插入功能
     - 技术要点：使用TipTap的CodeBlock扩展，基于StarterKit中已包含的基础代码块功能
     - 实现自定义CodeBlock节点渲染，支持更多交互功能
   
   - 添加代码块工具栏按钮
     - 技术要点：创建自定义按钮组件，集成到编辑器工具栏
     - 使用Tiptap的commands API添加代码块插入命令
   
   - 实现代码块样式定制
     - 技术要点：使用Tailwind CSS定制代码块样式，支持深色/浅色模式
     - 创建可复用的代码块组件，便于统一样式管理

   #### 4.2 语法高亮支持
   - 集成highlight.js库
     - 技术要点：使用TipTap的extension-code-block-lowlight扩展
     - 配置按需加载语言包，减小打包体积
   
   - 实现常见编程语言的语法高亮
     - 技术要点：配置highlight.js支持常用语言
     - 实现语言自动检测功能
     - 支持语言：JavaScript, TypeScript, Python, Java, C/C++, C#, PHP, Go, Rust, Swift, Kotlin, Ruby, HTML, CSS, SQL, Markdown, JSON, YAML, XML, Bash, PowerShell
   
   - 添加语言选择下拉菜单
     - 技术要点：创建自定义下拉菜单组件，更新代码块语言属性
     - 使用Tiptap的updateAttributes命令修改代码块语言

   #### 4.3 行号显示功能
   - 实现代码块行号显示
     - 技术要点：扩展CodeBlock渲染器，添加行号显示
     - 使用CSS计数器或自定义渲染实现行号显示
   
   - 添加行号显示切换选项
     - 技术要点：添加切换按钮，通过自定义属性控制行号显示
     - 实现行号显示状态的持久化存储
   
   - 优化行号与代码的对齐
     - 技术要点：使用CSS Grid或Flexbox确保行号与代码正确对齐
     - 处理长行和换行情况下的行号对齐问题

   #### 4.4 代码复制功能
   - 添加代码块复制按钮
     - 技术要点：创建悬浮复制按钮，使用Clipboard API
     - 集成到代码块组件中，位于右上角
   
   - 实现复制成功反馈提示
     - 技术要点：使用Tippy.js或自定义Toast组件显示反馈
     - 添加复制动画效果提升用户体验
   
   - 优化复制按钮的显示逻辑
     - 技术要点：实现鼠标悬停时显示复制按钮
     - 使用CSS过渡效果实现平滑显示/隐藏

   #### 4.6 代码块高级交互功能
   - 实现代码块内容折叠功能
     - 技术要点：扩展CodeBlock节点，添加折叠状态属性
     - 添加折叠/展开按钮，通过CSS控制内容显示状态
     - 使用Tiptap的NodeView实现自定义交互
     - 保存折叠状态，实现持久化
   
   - 实现代码块可拖动调整高度
     - 技术要点：使用ResizeObserver API或拖拽事件实现高度调整
     - 添加拖动手柄，类似Tiptap的DragHandle扩展实现
     - 保存自定义大小到节点属性中
     - 处理拖拽过程中的性能优化和边界限制
   
   - 实现代码块内容区域可滚动
     - 技术要点：设置最大高度和overflow属性，添加自定义滚动条样式
     - 使用CSS变量控制最大高度，便于动态调整
     - 优化滚动条样式，提升用户体验
     - 确保滚动不影响编辑体验

   ### 技术实现方案
   
   1. **基础实现**：使用TipTap的`CodeBlock`扩展结合`lowlight`实现语法高亮
      ```typescript
      import CodeBlock from '@tiptap/extension-code-block'
      import { lowlight } from 'lowlight/lib/core'
      
      // 导入需要的语言（按需加载）
      import javascript from 'highlight.js/lib/languages/javascript'
      import typescript from 'highlight.js/lib/languages/typescript'
      import python from 'highlight.js/lib/languages/python'
      import java from 'highlight.js/lib/languages/java'
      import cpp from 'highlight.js/lib/languages/cpp'
      import csharp from 'highlight.js/lib/languages/csharp'
      import php from 'highlight.js/lib/languages/php'
      import ruby from 'highlight.js/lib/languages/ruby'
      import go from 'highlight.js/lib/languages/go'
      import rust from 'highlight.js/lib/languages/rust'
      // 更多语言按需导入...
      
      // 注册语言
      lowlight.registerLanguage('javascript', javascript)
      lowlight.registerLanguage('typescript', typescript)
      lowlight.registerLanguage('python', python)
      lowlight.registerLanguage('java', java)
      lowlight.registerLanguage('cpp', cpp)
      lowlight.registerLanguage('csharp', csharp)
      lowlight.registerLanguage('php', php)
      lowlight.registerLanguage('ruby', ruby)
      lowlight.registerLanguage('go', go)
      lowlight.registerLanguage('rust', rust)
      // 更多语言按需注册...
      
      // 扩展CodeBlock
      const CustomCodeBlock = CodeBlock.extend({
        addAttributes() {
          return {
            ...this.parent?.(),
            language: {
              default: 'text',
              parseHTML: element => element.getAttribute('data-language') || 'text',
              renderHTML: attributes => {
                return { 'data-language': attributes.language }
              },
            },
            showLineNumbers: {
              default: true,
              parseHTML: element => element.hasAttribute('data-show-line-numbers'),
              renderHTML: attributes => {
                return attributes.showLineNumbers ? { 'data-show-line-numbers': '' } : {}
              },
            },
            isCollapsed: {
              default: false,
              parseHTML: element => element.hasAttribute('data-collapsed'),
              renderHTML: attributes => {
                return attributes.isCollapsed ? { 'data-collapsed': '' } : {}
              },
            },
            height: {
              default: null,
              parseHTML: element => element.getAttribute('data-height'),
              renderHTML: attributes => {
                return attributes.height ? { 'data-height': attributes.height } : {}
              },
            },
          }
        },
      })
      ```
   
   2. **CSS样式独立文件**：将代码块相关的样式提取到独立的CSS文件中，便于管理和复用
      
      创建 `codeBlock.css` 文件放到src\styles：
      ```css
      /* 代码块基础样式 */
      .code-block-wrapper {
        position: relative;
        margin: 1rem 0;
        border-radius: 0.5rem;
        background-color: var(--color-code-bg);
        overflow: hidden;
      }
      
      /* 代码块头部样式 */
      .code-block-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0.5rem 1rem;
        background-color: var(--color-code-header-bg);
        border-bottom: 1px solid var(--color-border);
      }
      
      .code-block-language {
        font-size: 0.875rem;
        font-weight: 500;
        color: var(--color-text-muted);
      }
      
      .code-block-actions {
        display: flex;
        gap: 0.5rem;
      }
      
      /* 代码块内容样式 */
      .code-block-body {
        position: relative;
      }
      
      /* 行号显示样式 */
      .code-block-with-line-numbers {
        counter-reset: line;
        display: grid;
        grid-template-columns: min-content 1fr;
      }
      
      .code-block-line-numbers {
        counter-reset: linenumber;
        user-select: none;
        padding-right: 0.5rem;
        color: var(--color-text-muted);
        text-align: right;
        border-right: 1px solid var(--color-border);
      }
      
      .code-block-line-numbers > div::before {
        counter-increment: linenumber;
        content: counter(linenumber);
        display: block;
        color: var(--color-text-muted);
      }
      
      .code-block-content {
        overflow-x: auto;
        padding-left: 0.5rem;
      }
      
      /* 折叠状态样式 */
      [data-collapsed="true"] .code-block-content {
        max-height: 3em;
        overflow: hidden;
      }
      
      /* 复制按钮样式 */
      .code-block-copy-button {
        opacity: 0;
        transition: opacity 0.2s ease;
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        padding: 0.25rem;
        background-color: var(--color-button-bg);
        border: none;
        border-radius: 0.25rem;
        cursor: pointer;
        color: var(--color-button-text);
      }
      
      .code-block-wrapper:hover .code-block-copy-button {
        opacity: 1;
      }
      
      /* 调整大小手柄样式 */
      .resize-handle {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 5px;
        cursor: ns-resize;
        background-color: transparent;
      }
      
      .resize-handle:hover, 
      .resize-handle:active {
        background-color: var(--color-border);
      }
      
      /* 深色/浅色模式变量 */
      :root {
        --color-code-bg: #f8f9fa;
        --color-code-header-bg: #f1f3f5;
        --color-text-muted: #6c757d;
        --color-border: #dee2e6;
        --color-button-bg: #e9ecef;
        --color-button-text: #495057;
      }
      
      .dark-theme {
        --color-code-bg: #212529;
        --color-code-header-bg: #343a40;
        --color-text-muted: #adb5bd;
        --color-border: #495057;
        --color-button-bg: #495057;
        --color-button-text: #f8f9fa;
      }
      ```
      
      在组件中导入CSS：
      ```typescript
      import './codeBlock.css';
      
      // 组件代码...
      ```
   
   3. **复制功能**：
      ```typescript
      const CopyButton = ({ editor, node }) => {
        const copyCode = () => {
          const code = node.textContent;
        navigator.clipboard.writeText(code).then(() => {
          showToast('代码已复制');
        });
        };
      
        return (
          <button 
            className="code-block-copy-button" 
            onClick={copyCode}
            title="复制代码"
          >
            <CopyIcon size={16} />
          </button>
        );
      };
      ```
   
   4. **Markdown语法支持与语言选择下拉菜单**：
      ```typescript
      import { InputRule } from '@tiptap/core';
      
      const codeBlockInputRule = new InputRule({
        find: /^```(\w+)?$/,
        handler: ({ state, range, match }) => {
          const language = match[1] || 'text';
          // 创建代码块节点
          const { tr } = state;
          tr.replaceRangeWith(range.from, range.to, createCodeBlock(state.schema, language));
          return tr;
        }
      });
      
      const codeBlockTriggerRule = new InputRule({
        find: /```$/,
        handler: ({ state, range, editor }) => {
          // 保存当前光标位置
          const cursorPos = range.to;
          
          // 显示语言选择下拉菜单
          const { view } = editor;
          const coords = view.coordsAtPos(cursorPos);
          
          showLanguageSelector({
            position: coords,
            languages: [
              // 常用语言
              { value: 'javascript', label: 'JavaScript' },
              { value: 'typescript', label: 'TypeScript' },
              { value: 'python', label: 'Python' },
              { value: 'java', label: 'Java' },
              { value: 'cpp', label: 'C++' },
              { value: 'csharp', label: 'C#' },
              { value: 'php', label: 'PHP' },
              { value: 'html', label: 'HTML' },
              { value: 'css', label: 'CSS' },
              { value: 'sql', label: 'SQL' },
              
              // 更多语言（可分组展示）
              { group: '前端', value: 'javascript', label: 'JavaScript' },
              { group: '前端', value: 'typescript', label: 'TypeScript' },
              { group: '前端', value: 'html', label: 'HTML' },
              { group: '前端', value: 'css', label: 'CSS' },
              { group: '前端', value: 'scss', label: 'SCSS' },
              { group: '前端', value: 'less', label: 'LESS' },
              
              { group: '后端', value: 'python', label: 'Python' },
              { group: '后端', value: 'java', label: 'Java' },
              { group: '后端', value: 'csharp', label: 'C#' },
              { group: '后端', value: 'php', label: 'PHP' },
              { group: '后端', value: 'ruby', label: 'Ruby' },
              { group: '后端', value: 'go', label: 'Go' },
              
              { group: '系统/底层', value: 'c', label: 'C' },
              { group: '系统/底层', value: 'cpp', label: 'C++' },
              { group: '系统/底层', value: 'rust', label: 'Rust' },
              { group: '系统/底层', value: 'assembly', label: 'Assembly' },
              
              { group: '移动开发', value: 'swift', label: 'Swift' },
              { group: '移动开发', value: 'kotlin', label: 'Kotlin' },
              { group: '移动开发', value: 'objectivec', label: 'Objective-C' },
              { group: '移动开发', value: 'dart', label: 'Dart' },
              
              { group: '数据/科学', value: 'r', label: 'R' },
              { group: '数据/科学', value: 'julia', label: 'Julia' },
              { group: '数据/科学', value: 'matlab', label: 'MATLAB' },
              { group: '数据/科学', value: 'sql', label: 'SQL' },
              
              { group: '标记/配置', value: 'markdown', label: 'Markdown' },
              { group: '标记/配置', value: 'json', label: 'JSON' },
              { group: '标记/配置', value: 'yaml', label: 'YAML' },
              { group: '标记/配置', value: 'xml', label: 'XML' },
              
              { group: '脚本/Shell', value: 'bash', label: 'Bash' },
              { group: '脚本/Shell', value: 'powershell', label: 'PowerShell' },
              { group: '脚本/Shell', value: 'perl', label: 'Perl' },
              { group: '脚本/Shell', value: 'lua', label: 'Lua' },
            ],
            onSelect: (language) => {
              // 用户选择语言后创建代码块
              const { tr } = state;
              // 删除触发字符```
              tr.delete(range.from, range.to);
              // 插入带选定语言的代码块
              tr.replaceRangeWith(range.from, range.from, createCodeBlock(state.schema, language));
              editor.view.dispatch(tr);
            }
          });
          
          return true; // 阻止默认处理
        }
      });
      ```
   
   5. **代码块折叠功能**：
      ```typescript
      const CodeBlockView = (props) => {
        const { node, editor } = props;
        const isCollapsed = node.attrs.isCollapsed;
        
        const toggleCollapse = () => {
          editor.commands.updateAttributes('codeBlock', {
            isCollapsed: !isCollapsed,
          });
        };
        
        return (
          <div className="code-block-wrapper">
            <div className="code-block-header">
              <span className="code-block-language">{node.attrs.language || 'text'}</span>
              <div className="code-block-actions">
                <button 
                  className="code-block-toggle-button" 
                  onClick={toggleCollapse}
                  title={isCollapsed ? "展开" : "折叠"}
                >
                  {isCollapsed ? <ExpandIcon size={16} /> : <ListCollapse size={16} />}
                </button>
                <CopyButton editor={editor} node={node} />
              </div>
            </div>
            <div 
              className="code-block-body"
              data-collapsed={isCollapsed}
            >
              {/* 代码块内容 */}
            </div>
          </div>
        );
      };
      ```
   
   6. **可调整大小功能**：
      ```typescript
      const ResizableCodeBlock = (props) => {
        const { node, editor } = props;
        const [height, setHeight] = useState(node.attrs.height || null);
        
        const handleResize = (event) => {
          const startY = event.clientY;
          const startHeight = height || 200;
          
          const onMouseMove = (moveEvent) => {
            const newHeight = startHeight + moveEvent.clientY - startY;
            if (newHeight > 50) {
              setHeight(newHeight);
            }
          };
          
          const onMouseUp = () => {
            document.removeEventListener('mousemove', onMouseMove);
            document.removeEventListener('mouseup', onMouseUp);
            
            // 保存高度到节点属性
            editor.commands.updateAttributes('codeBlock', {
              height: height,
            });
          };
          
          document.addEventListener('mousemove', onMouseMove);
          document.addEventListener('mouseup', onMouseUp);
        };
        
        return (
          <div className="resizable-code-block">
            <div 
              className="code-block-content"
              style={{ maxHeight: height ? `${height}px` : 'auto', overflow: 'auto' }}
            >
              {/* 代码块内容 */}
            </div>
            <div 
              className="resize-handle"
              onMouseDown={handleResize}
            />
          </div>
        );
      };
      ```



graph TD
    A[编辑器] --> B[代码块增强]
    B --> C[语法高亮]
    B --> D[行号显示]
    B --> E[代码复制]
    B --> F[折叠功能]
    B --> G[高度调整]
    
    C --> C1[支持20+编程语言]
    D --> D1[可开关行号显示]
    E --> E1[复制按钮与反馈]
    F --> F1[折叠/展开切换]
    G --> G1[拖动手柄调整高度]
    
    style A fill:#f9f9f9,stroke:#333,stroke-width:2px
    style B fill:#e6f7ff,stroke:#333,stroke-width:2px
    style C,D,E,F,G fill:#f0f0f0,stroke:#333,stroke-width:1px



    现有问题：去掉折叠功能，代码编辑不正常，光标不在代码块内编辑，或者输入内容跑出文档。样式没有匹配亮色与暗色模式，没有拖动手柄，应该在代码块下边框可拖动调整高度