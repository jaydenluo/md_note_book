# 跨平台笔记软件开发计划书

## 项目概述

### 项目名称
NoteBook - 跨平台智能笔记软件

### 项目目标
开发一款可在 Windows 和 macOS 上运行的桌面笔记软件，支持分类管理、Markdown 编辑、定时提醒和云盘同步功能。

### 技术方案
- **框架**: Tauri + React + TypeScript
- **数据存储**: SQLite + 本地文件系统
- **提醒功能**: Web Workers + 系统通知
- **云同步**: 云盘目录自动同步

## 技术架构

### 核心技术栈
- 前端框架: React 18 + TypeScript
- 桌面容器: Tauri 2.0
- 状态管理: Zustand
- 数据存储: SQLite
- 文件操作: Tauri API
- Markdown: markdown-it + highlight.js
- UI组件: Lucide React
- 样式: Tailwind CSS
- 富文本编辑器: Tiptap

### 项目结构
- src-tauri/ - Tauri 配置
- src/ - React 前端
  - components/ - 组件目录
  - pages/ - 页面组件
  - hooks/ - 自定义 hooks
  - stores/ - 状态管理
  - services/ - 业务服务
  - utils/ - 工具函数
  - types/ - TypeScript 类型
  - workers/ - Web Workers
- public/ - 静态资源
- docs/ - 项目文档

## 功能模块设计

### 1. 笔记管理模块
- **功能描述**: 创建、编辑、删除、搜索笔记
- **技术实现**: 
  - 使用 SQLite 存储笔记元数据
  - 使用本地文件系统存储 Markdown 文件
  - 实时预览和语法高亮
  - Tiptap 富文本编辑器
  - 基础格式工具栏（加粗、斜体、下划线、删除线、标题、对齐、列表等）

### 2. 分类管理模块
- **功能描述**: 创建、编辑、删除分类，支持拖拽排序
- **技术实现**: 
  - SQLite 存储分类信息
  - 支持分类颜色标识
  - 分类层级管理

### 3. 提醒功能模块
- **功能描述**: 设置定时提醒，支持重复提醒
- **技术实现**: 
  - Web Workers 处理后台定时任务
  - 系统通知 API
  - SQLite 存储提醒配置

### 4. 云同步模块
- **功能描述**: 自动同步到云盘目录
- **技术实现**: 
  - 监听本地文件变化
  - 自动备份到云盘目录
  - 冲突检测和解决
- **同步策略**:
  - 实时监听文件变化
  - 定期全量同步
  - 增量同步优化

## 开发阶段规划

### 第一阶段：项目基础搭建 (1周)
**目标**: 完成项目初始化和基础架构

**任务清单**:
- [x] 创建 Tauri 项目
- [x] 配置 React + TypeScript 环境
- [x] 安装和配置必要依赖
- [x] 设置项目结构和代码规范
- [x] 配置开发环境和构建流程

### 第二阶段：数据存储层开发 (1周)
**目标**: 实现数据持久化和文件操作

**任务清单**:
- [ ] 设计数据库结构
- [ ] 实现 SQLite 数据库服务
- [ ] 实现文件系统服务
- [ ] 编写数据访问层
- [ ] 添加数据迁移功能

### 第三阶段：核心功能开发 (2周)
**目标**: 实现笔记编辑和分类管理功能

**任务清单**:
- [x] 实现笔记编辑器组件
- [x] 实现基础格式工具栏
- [x] 优化编辑器焦点管理
- [ ] 实现分类管理组件
- [ ] 实现侧边栏导航
- [ ] 添加 Markdown 预览功能
- [ ] 实现搜索和筛选功能

**已完成功能**:
- Tiptap 富文本编辑器集成
- 基础格式工具栏（加粗、斜体、下划线、删除线、标题、对齐、列表、引用、代码块）
- 编辑器焦点管理优化（解决工具栏按钮需要点击两次的问题）
- 简洁朴素的UI设计风格
- 紧凑的行间距设计（line-height: 1.4）
- 编辑器背景颜色与主界面统一（bg-gray-100 dark:bg-gray-900）

### 第四阶段：提醒功能开发 (1周)
**目标**: 实现定时提醒功能

**任务清单**:
- [ ] 实现提醒服务
- [ ] 创建 Web Worker 处理定时任务
- [ ] 实现系统通知功能
- [ ] 添加提醒管理界面
- [ ] 实现重复提醒逻辑

### 第五阶段：云同步功能开发 (1周)
**目标**: 实现云盘同步功能

**任务清单**:
- [ ] 实现文件变化监听
- [ ] 实现云盘目录同步
- [ ] 添加冲突检测和解决
- [ ] 实现增量同步优化
- [ ] 添加同步状态显示

### 第六阶段：UI/UX 优化 (1周)
**目标**: 优化用户界面和用户体验

**任务清单**:
- [x] 设计现代化 UI 界面
- [x] 实现简洁朴素的工具栏设计
- [ ] 实现响应式布局
- [ ] 添加主题切换功能
- [ ] 优化交互体验
- [ ] 添加快捷键支持

**UI 特性**:
- 现代化设计风格
- 深色/浅色主题切换
- 响应式布局适配
- 流畅的动画效果
- 直观的操作反馈
- 简洁朴素的工具栏设计

### 第七阶段：测试和优化 (1周)
**目标**: 确保软件稳定性和性能

**任务清单**:
- [ ] 单元测试编写
- [ ] 集成测试
- [ ] 性能优化
- [ ] 内存泄漏检测
- [ ] 跨平台兼容性测试

**测试策略**:
- 单元测试覆盖率 > 80%
- 集成测试覆盖主要功能
- 性能测试确保响应时间 < 100ms
- 内存使用优化

### 第八阶段：打包和发布 (0.5周)
**目标**: 完成应用打包和发布准备

**任务清单**:
- [ ] 配置 Tauri 打包设置
- [ ] 生成 Windows 安装包
- [ ] 生成 macOS 应用包
- [ ] 代码签名配置
- [ ] 发布文档编写

## 技术难点和解决方案

### 1. 文件系统权限
**问题**: 访问本地文件系统的权限管理
**解决方案**: 使用 Tauri 的文件系统 API，提供清晰的权限提示

### 2. 定时提醒实现
**问题**: 桌面环境下的定时任务实现
**解决方案**: 结合 Web Workers 和 Tauri 的系统通知功能

### 3. 数据同步冲突
**问题**: 多设备同步时的数据冲突
**解决方案**: 实现版本控制和冲突检测算法

### 4. 大文件处理
**问题**: 大 Markdown 文件的性能问题
**解决方案**: 实现虚拟滚动和分块加载

### 5. SQLite 数据管理
**问题**: 确保数据完整性和高效查询
**解决方案**: 优化数据库结构，使用事务和索引提升性能

### 6. 编辑器焦点管理
**问题**: 工具栏按钮需要点击两次才能生效
**解决方案**: 
- 实现焦点管理优化，按钮点击时先让编辑器失去焦点
- 使用 requestAnimationFrame 确保焦点操作完成后再执行命令
- 阻止事件冒泡和 mousedown 事件，防止编辑器意外获得焦点
- 命令执行完成后恢复编辑器焦点

## 风险评估和应对

### 高风险项
1. **数据库迁移兼容性**
   - 风险: 从旧版本迁移数据可能出现问题
   - 应对: 设计稳健的迁移方案，提供数据备份功能

2. **Web Workers 限制**
   - 风险: 某些环境下 Worker 功能受限
   - 应对: 实现备用的定时器方案

3. **跨平台兼容性**
   - 风险: Windows 和 macOS 行为差异
   - 应对: 充分测试，提供平台特定优化

### 中风险项
1. **数据丢失风险**
   - 风险: SQLite 数据库损坏
   - 应对: 实现自动备份和恢复机制

2. **性能问题**
   - 风险: 大量笔记时的性能下降
   - 应对: 实现分页加载和查询优化

## 质量保证

### 代码质量
- 使用 ESLint + Prettier 规范代码风格
- TypeScript 严格模式确保类型安全
- 代码审查流程确保代码质量

### 测试策略
- 单元测试覆盖核心业务逻辑
- 集成测试验证功能完整性
- 端到端测试确保用户体验

### 性能指标
- 应用启动时间 < 3秒
- 笔记保存响应时间 < 100ms
- 内存使用 < 200MB
- 文件操作响应时间 < 500ms

## 项目里程碑

| 阶段 | 时间 | 交付物 | 验收标准 |
|------|------|--------|----------|
| 第一阶段 | 第1周 | 项目基础架构 | 项目可正常启动和构建 |
| 第二阶段 | 第2周 | 数据存储层 | SQLite数据库可正常存储和读取 |
| 第三阶段 | 第3-4周 | 核心功能 | 笔记编辑和分类管理可用 |
| 第四阶段 | 第5周 | 提醒功能 | 定时提醒功能正常 |
| 第五阶段 | 第6周 | 云同步 | 文件可同步到云盘 |
| 第六阶段 | 第7周 | UI优化 | 界面美观，交互流畅 |
| 第七阶段 | 第8周 | 测试优化 | 通过所有测试用例 |
| 第八阶段 | 第8.5周 | 发布版本 | 可安装运行的应用包 |

## 资源需求

### 开发环境
- **操作系统**: Windows 10/11 或 macOS 10.15+
- **Node.js**: 18.0+
- **Rust**: 1.70+
- **IDE**: VS Code + 相关插件

### 开发工具
- **版本控制**: Git
- **包管理**: npm/yarn/pnpm
- **构建工具**: Vite
- **测试框架**: Jest + Testing Library

### 第三方服务
- **云盘服务**: 用户自选 (OneDrive, iCloud, Dropbox等)
- **代码托管**: GitHub/GitLab
- **CI/CD**: GitHub Actions

## 成功标准

### 功能完整性
- [ ] 支持创建、编辑、删除笔记
- [ ] 支持分类管理和层级结构
- [ ] 支持 Markdown 编辑和预览
- [ ] 支持定时提醒功能
- [ ] 支持云盘同步
- [ ] 支持搜索和筛选

### 性能指标
- [ ] 应用启动时间 < 3秒
- [ ] 笔记保存响应时间 < 100ms
- [ ] 支持 1000+ 笔记文件
- [ ] 内存使用 < 200MB

### 用户体验
- [ ] 界面美观，操作直观
- [ ] 支持快捷键操作
- [ ] 响应式布局适配
- [ ] 深色/浅色主题切换

### 稳定性
- [ ] 无数据丢失风险
- [ ] 异常情况优雅处理
- [ ] 跨平台兼容性良好
- [ ] 长期运行稳定

## 维护计划

### 版本更新策略
- **小版本更新**: 每月发布，修复 bug 和优化性能
- **大版本更新**: 每季度发布，添加新功能
- **安全更新**: 及时发布，修复安全漏洞

### 用户支持
- 提供详细的使用文档
- 建立用户反馈渠道
- 定期收集用户需求
- 提供在线技术支持

### 技术债务管理
- 定期代码重构
- 更新依赖版本
- 优化性能瓶颈
- 改进代码架构

### 数据管理
- 定期数据库优化
- 提供数据备份和恢复功能
- 支持数据导入导出

## 编辑器功能增强计划

### 已完成 ✅
1. **基础格式工具栏** - 2024年实现
   - 加粗、斜体、下划线、删除线等基本文本格式
   - 标题级别（H1-H3）
   - 对齐方式（左、中、右对齐）
   - 列表（有序、无序）
   - 引用块和代码块
   - 撤销/重做功能

2. **编辑器美化** - 2024年实现
   - 🎨 简洁工具栏设计
     - 朴素的外观和布局
     - 简单的悬停效果
     - 清晰的激活状态指示
     - 基础的工具提示
   - 📝 简洁的内容排版
     - 标准的标题样式
     - 简洁的引用块设计
     - 基础的代码块样式
     - 简单的滚动条
     - 响应式设计适配
   - 🌓 深色/浅色主题支持
     - 完整的主题切换
     - 优化的颜色对比度
     - 一致的视觉体验
   - ✨ 简洁的交互体验
     - 基础的工具提示
     - 简单的焦点状态
     - 平滑的颜色过渡
     - 移动端适配

### 待实现 🔄
2. **代码块支持**
   - 添加代码块
   - 语法高亮
   - 代码块样式定制

3. **引用块和分隔线**
   - 引用文本块样式
   - 水平分隔线插入

4. **图片插入与管理**
   - 本地图片上传
   - 图片大小调整
   - 图片说明文本

5. **表格支持**
   - 插入简单表格
   - 表格行列编辑
   - 表格样式调整

6. **链接功能**
   - 添加超链接
   - 内部笔记链接（双向链接）

7. **任务列表**
   - 可勾选的任务项
   - 任务完成状态管理

8. **自动保存与历史版本**
   - 定时自动保存
   - 编辑历史查看
   - 版本回滚

9. **markdown预览**
   - 实时预览功能
   - 预览与编辑分屏

10. **高级格式化**
    - LaTeX数学公式支持
    - 流程图/思维导图
    - 时间轴

11. **协同编辑**
    - 多人同时编辑支持
    - 变更冲突解决

## 开发规范

### 代码规范
- 使用TypeScript进行类型检查
- 遵循ESLint规则
- 使用Prettier进行代码格式化
- 组件使用函数式组件和Hooks

### 文件组织
- 组件放在`src/components`目录
- 状态管理放在`src/stores`目录
- 工具函数放在`src/utils`目录
- 类型定义放在`src/types`目录

### 命名规范
- 组件使用PascalCase
- 文件使用kebab-case
- 变量和函数使用camelCase
- 常量使用UPPER_SNAKE_CASE

### 注释规范
- 为所有关键代码添加中文注释
- 注释应该说明代码的作用和目的
- 使用JSDoc格式的注释

## 部署和发布

### 开发环境
- 使用`pnpm dev`启动开发服务器
- 使用`pnpm tauri dev`启动桌面应用开发模式

### 构建和打包
- 使用`pnpm build`构建Web版本
- 使用`pnpm tauri build`构建桌面应用

### 发布流程
1. 更新版本号
2. 构建应用
3. 生成安装包
4. 上传到发布平台

## 性能优化

### 前端优化
- 使用React.memo优化组件渲染
- 使用useMemo和useCallback优化计算
- 实现虚拟滚动优化长列表
- 使用懒加载优化资源加载

### 桌面应用优化
- 优化启动时间
- 减少内存占用
- 优化文件读写性能
- 实现增量同步

## 测试策略

### 单元测试
- 使用Vitest进行单元测试
- 测试覆盖率要求>80%
- 重点测试业务逻辑和工具函数

### 集成测试
- 测试组件间交互
- 测试数据流
- 测试用户操作流程

### 端到端测试
- 使用Playwright进行E2E测试
- 测试关键用户场景
- 测试跨平台兼容性

## 安全考虑

### 数据安全
- 本地数据加密存储
- 云端数据传输加密
- 用户隐私保护

### 应用安全
- 输入验证和过滤
- XSS防护
- 文件上传安全检查

## 维护和支持

### 错误监控
- 实现错误日志记录
- 用户反馈收集
- 性能监控

### 版本管理
- 语义化版本控制
- 更新日志维护
- 向后兼容性保证

## 未来规划

### 短期目标（1-3个月）
- 完善编辑器功能
- 优化用户体验
- 修复已知问题

### 中期目标（3-6个月）
- 添加高级功能
- 性能优化
- 多平台支持

### 长期目标（6-12个月）
- 企业级功能
- 插件系统
- 社区生态建设

---

**文档版本**: v1.1  
**创建日期**: 2024年12月  
**最后更新**: 2024年12月  
**负责人**: 开发团队 